<!DOCTYPE html>
<html>
<head>
  <title>Webcam Image Classification</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
  <script>
    async function run() {
      // Загрузка модели TensorFlow.js
      const model = await tf.loadLayersModel('model.json');

      // Получение доступа к веб-камере
      const videoElement = document.getElementById('video');
      const constraints = { video: true };
      const stream = await navigator.mediaDevices.getUserMedia(constraints);
      videoElement.srcObject = stream;
      await videoElement.play();

      // Создание Canvas элемента для отображения видеопотока и результатов классификации
      const canvas = document.getElementById('canvas');
      const context = canvas.getContext('2d');
      canvas.width = videoElement.videoWidth;
      canvas.height = videoElement.videoHeight;

      // Функция для классификации текущего кадра с помощью модели TensorFlow.js
      async function classifyFrame() {
        context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
        const image = tf.browser.fromPixels(canvas);
        const resizedImage = tf.image.resizeBilinear(image, [model.inputs[0].shape[1], model.inputs[0].shape[2]]);
        const processedImage = resizedImage.expandDims();
        const predictions = await model.predict(processedImage).data();
        const topPrediction = Array.from(predictions).map((p, i) => {
          return {
            probability: p,
            className: model.outputLayers[0].classes[i]
          };
        }).sort((a, b) => b.probability - a.probability)[0];

        console.log('Top Prediction:', topPrediction);
        requestAnimationFrame(classifyFrame);
      }

      // Запуск классификации кадров
      classifyFrame();
    }

    // Запуск приложения после полной загрузки страницы
    document.addEventListener('DOMContentLoaded', run);
  </script>
</head>
<body>
  <h1>Webcam Image Classification</h1>
  <video id="video" width="640" height="480" autoplay></video>
  <canvas id="canvas"></canvas>
</body>
</html>

